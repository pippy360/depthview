<html>
<script src="js/three.min.js"></script>
<script>
    var camera, scene, renderer;
    var geometry, material, mesh;


    function init(imgData, imgWidth, imageHeight) {

        camera = new THREE.PerspectiveCamera( 70, window.innerWidth / window.innerHeight, 0.01, 10 );
        camera.position.z = 1;

        scene = new THREE.Scene();

        geometry = new THREE.BoxGeometry( 0.2, 0.2, 0.2 );
        material = new THREE.MeshNormalMaterial();

        mesh = new THREE.Mesh( geometry, material );
        //scene.add( mesh );
        for (var i = 0; i < imgData.length/4; i++){
            var xPos = i%imgWidth;
            var yPos = parseInt(i/imgWidth);
            console.log("x: " + xPos + " y:" + yPos)
            var geometry = new THREE.SphereGeometry( 0.01, 0.01, 1 );
            var material = new THREE.MeshBasicMaterial( {color: 0xffff00 + (0x10) } );
            var sphere = new THREE.Mesh( geometry, material );
            sphere.position.set(xPos/imgWidth, yPos/imageHeight, -1*(imgData[i*4]/255.0));
            scene.add( sphere );
        }

        renderer = new THREE.WebGLRenderer( { antialias: true } );
        renderer.setSize( 800, 600 );
        document.body.appendChild( renderer.domElement );
    }

    function animate() {

        requestAnimationFrame( animate );

        mesh.rotation.x += 0.01;
        mesh.rotation.y += 0.02;

        renderer.render( scene, camera );

    }


    function getBase64Image(img) {
        // Create an empty canvas element
        var canvas = document.createElement("canvas");
        canvas.width = img.width;
        canvas.height = img.height;

        // Copy the image contents to the canvas
        var ctx = canvas.getContext("2d");
        ctx.drawImage(img, 0, 0);

        // Get the data-URL formatted image
        // Firefox supports PNG and JPEG. You could check img.src to
        // guess the original format, but be aware the using "image/jpg"
        // will re-encode the image.
        var imageData = canvas.getContext('2d').getImageData(0, 0, canvas.width, canvas.height);
        return imageData.data;
    }

    g_img = new Image();
    g_img.src = "00004.png";
    g_img.onload = function () {
        console.log("getBase64Image(g_img)")
        imgData = getBase64Image(g_img)
        console.log(imgData)
        init(imgData, 74, 54);
        animate();
    };
</script>
<body></body>

</html>